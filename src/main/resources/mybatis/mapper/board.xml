<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.couple.back.mybatis.BoardMapper">


	<select id="selectBoardDatas" parameterType="map" resultType="com.couple.back.model.Board" >
	    SELECT
            b.board_id as "boardId",
            b.category,
            b.title,
            b.create_date_time as "createDateTime",
			b.create_user_id as "createUserId", 
			b.update_date_time as "updateDateTime",
			b.update_user_id as "updateUserId"
            <if test="includeClobDataYn != null and includeClobDataYn == 'Y'">
                ,b.content
            </if>
        FROM board b
        INNER JOIN users u
        ON b.create_user_id = u.user_id
        <where>
            <if test="searchWord != null and searchWord != ''">
            	<choose>
                    <when  test="searchType == 'title'">
                        AND UPPER(b.title) LIKE UPPER('%' || #{searchWord} || '%')
                    </when>
                    <when  test="searchType == 'category'">
                        AND UPPER(b.category) LIKE UPPER('%' || #{searchWord} || '%')
                    </when>
                    <when  test="searchType == 'author'">
                        AND UPPER(u.user_id) LIKE UPPER('%' || #{searchWord} || '%')
                    </when>
                </choose>
            </if>
        </where>
        ORDER BY b.create_date_time DESC
        LIMIT #{limit} OFFSET #{offset}
	</select>

    
    <select id="totalBoardCount" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM board b
        INNER JOIN users u
        ON b.create_user_id = u.user_id
        <where>
            <if test="searchWord != null and searchWord != ''">
            	<choose>
                    <when  test="searchType == 'title'">
                        AND UPPER(b.title) LIKE UPPER('%' || #{searchWord} || '%')
                    </when>
                    <when  test="searchType == 'category'">
                        AND UPPER(b.category) LIKE UPPER('%' || #{searchWord} || '%')
                    </when>
                    <when  test="searchType == 'author'">
                        AND UPPER(u.user_id) LIKE UPPER('%' || #{searchWord} || '%')
                    </when>
                </choose>
            </if>
        </where>
    </select>

	

</mapper>